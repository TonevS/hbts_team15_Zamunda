<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- Include the CesiumJS JavaScript and CSS files -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.107/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
</head>

<style>
    body {
        margin: 0px;
    }
</style>
<body>
    <div id="cesiumContainer"></div>
    <script type="module">
        // Your access token can be found at: https://ion.cesium.com/tokens.
        // This is the default access token from your ion account
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhNmE3MGUwMC0xZTFlLTRjNzUtYjRiZi0xMTg4NmRkMWFkMmUiLCJpZCI6MTUxOTAwLCJpYXQiOjE2ODg2NDM5NzV9.R_qSu5vM04YAu20SES8mNMhc_gxaoW1B2wPqP_cbr4I';

        // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
       const viewer = new Cesium.Viewer("cesiumContainer", {
            globe: false,
            infoBox: false,
            selectionIndicator: false,
        });
        try {
            const tileset = await Cesium.createGooglePhotorealistic3DTileset();
            viewer.scene.primitives.add(tileset);
        } catch (error) {
            console.log(`Failed to load tileset: ${error}`);
        }

        
        viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(-73.9855, 40.7431, 15000),
            point: {
                show: true, // default
                color: Cesium.Color.YELLOW, // default: WHITE
                pixelSize: 10, // default: 1
            },
        });
        Cesium.Label.enableRightToLeftDetection = true;
        const newYork = viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(-73.9855, 40.7431, 150000),
            label: {
                id: 'my label',
                text: 'New York',
                font: '24px Helvetica',
                fillColor: Cesium.Color.YELLOW,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 2,
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                pixelOffset: new Cesium.Cartesian2(0, -9),
                eyeOffset: new Cesium.Cartesian3(0, 0, -9),
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
            },
        });

        viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(3.6147, 51.4965, 15000),
            point: {
                show: true, // default
                color: Cesium.Color.YELLOW, // default: WHITE
                pixelSize: 10, // default: 1
                distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0, 35000000), // default: undefined
            },
        }); 

        const middleburg = viewer.entities.add({
            position: Cesium.Cartesian3.fromDegrees(3.6147, 51.4965, 150000),
            label: {
                id: 'my label',
                text: 'Middleburg',
                font: '24px Helvetica',
                fillColor: Cesium.Color.YELLOW,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 2,
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                pixelOffset: new Cesium.Cartesian2(0, -9),
                eyeOffset: new Cesium.Cartesian3(0, 0, -9),
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
            },
        });

        function flyToMiddel(){
            flyAnimation(3.6147, 51.4965, 300);
        }
        function flyToNewYork(){
            flyAnimation(-73.9855, 40.7431, 600);
        }
        function flyAnimation(long, lat, height){
            var cartograph = Cesium.Cartographic.fromCartesian(viewer.camera.position);
            var cameraHeight = cartograph.height;
            var cameraLongtitude = Cesium.Math.toDegrees(cartograph.longitude);
            var cameraLatitude = Cesium.Math.toDegrees(cartograph.latitude);
            
            console.log(cameraHeight)
            console.log(cameraLongtitude)
            console.log(cameraLatitude)
            if (cameraHeight < 1000){
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees((long + cameraLongtitude)/2, (lat + cameraLatitude)/2 > 0 ? (lat + cameraLatitude)/2 - 20 : (lat + cameraLatitude)/2 + 20, cameraHeight+10000000),
                    orientation: {
                        heading: Cesium.Math.toRadians(0.0),
                        pitch: Cesium.Math.toRadians(-80.0),
                    },
                    complete: function(){
                        const dashedLine = viewer.entities.add({
                            name: "Blue dashed line",
                            polyline: {
                                positions: Cesium.Cartesian3.fromDegreesArrayHeights([
                                    cameraLongtitude,
                                    cameraLatitude,
                                    1000,
                                    long,
                                    lat,
                                    1000,
                                ]),
                                width: 4,
                                material: new Cesium.PolylineDashMaterialProperty({
                                    color: Cesium.Color.CYAN,
                                }),
                            },
                        });
                    }
                })
            }

            if (cameraHeight < 1000){
                setTimeout(flyDestination, 5000)
            } else {
                flyDestination();
            }
            
            function flyDestination(){
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(long, lat, height),
                    orientation: {
                        heading: Cesium.Math.toRadians(0.0),
                        pitch: Cesium.Math.toRadians(-35.0),
                    }
                }); 
            }
        }

        function ok(){
            console.log(cartograph.poisitionCartographic);
        }


        viewer.animation.container.style.visibility = 'hidden';
        viewer.timeline.container.style.visibility = 'hidden';
        viewer.forceResize();  


        window.onkeyup = function(e) {
            // test();
            switch(e.key){
                case "ArrowRight":
                    flyToMiddel();
                    break;
                case "ArrowLeft":
                    flyToNewYork();
                default:
                    break;
            }
        }
    </script>
    </div>
</body>

</html>